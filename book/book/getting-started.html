<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started - Firecracker</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="CHARTER.html"><strong aria-hidden="true">2.</strong> Firecracker Charter</a></li><li class="chapter-item expanded "><a href="CODE_OF_CONDUCT.html"><strong aria-hidden="true">3.</strong> Code of Conduct</a></li><li class="chapter-item expanded "><a href="SECURITY.html"><strong aria-hidden="true">4.</strong> Security</a></li><li class="chapter-item expanded "><a href="getting-started.html" class="active"><strong aria-hidden="true">5.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="CONTRIBUTING.html"><strong aria-hidden="true">6.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="dev-machine-setup.html"><strong aria-hidden="true">7.</strong> Development Machine Setup</a></li><li class="chapter-item expanded "><a href="api-change-runbook.html"><strong aria-hidden="true">8.</strong> API Change Runbook</a></li><li class="chapter-item expanded "><a href="RELEASE_POLICY.html"><strong aria-hidden="true">9.</strong> Releases</a></li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">10.</strong> Design</a></li><li class="chapter-item expanded "><a href="prod-host-setup.html"><strong aria-hidden="true">11.</strong> Production Host Setup</a></li><li class="chapter-item expanded "><a href="network-setup.html"><strong aria-hidden="true">12.</strong> Network Setup</a></li><li class="chapter-item expanded "><a href="kernel-policy.html"><strong aria-hidden="true">13.</strong> Kernel Support Policy</a></li><li class="chapter-item expanded "><a href="SPECIFICATION.html"><strong aria-hidden="true">14.</strong> Specification</a></li><li class="chapter-item expanded "><a href="network-performance.html"><strong aria-hidden="true">15.</strong> Network Performance</a></li><li class="chapter-item expanded "><a href="FAQ.html"><strong aria-hidden="true">16.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="rootfs-and-kernel-setup.html"><strong aria-hidden="true">17.</strong> Creating Custom rootfs and kernel Images</a></li><li class="chapter-item expanded "><a href="ballooning.html"><strong aria-hidden="true">18.</strong> Ballooning</a></li><li class="chapter-item expanded "><a href="devctr-image.html"><strong aria-hidden="true">19.</strong> Development Container</a></li><li class="chapter-item expanded "><a href="device-api.html"><strong aria-hidden="true">20.</strong> Device API</a></li><li class="chapter-item expanded "><a href="entropy.html"><strong aria-hidden="true">21.</strong> Entropy</a></li><li class="chapter-item expanded "><a href="formal-verification.html"><strong aria-hidden="true">22.</strong> Formal Verification</a></li><li class="chapter-item expanded "><a href="initrd.html"><strong aria-hidden="true">23.</strong> initrd</a></li><li class="chapter-item expanded "><a href="jailer.html"><strong aria-hidden="true">24.</strong> Jailer</a></li><li class="chapter-item expanded "><a href="logger.html"><strong aria-hidden="true">25.</strong> Logger</a></li><li class="chapter-item expanded "><a href="metrics.html"><strong aria-hidden="true">26.</strong> Metrics</a></li><li class="chapter-item expanded "><a href="seccomp.html"><strong aria-hidden="true">27.</strong> Seccomp</a></li><li class="chapter-item expanded "><a href="seccompiler.html"><strong aria-hidden="true">28.</strong> Seccompiler</a></li><li class="chapter-item expanded "><a href="tracing.html"><strong aria-hidden="true">29.</strong> Tracing</a></li><li class="chapter-item expanded "><a href="vsock.html"><strong aria-hidden="true">30.</strong> VSock</a></li><li class="chapter-item expanded "><a href="api-requests.html"><strong aria-hidden="true">31.</strong> API Requests</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">31.1.</strong> Actons</a></li><li class="chapter-item expanded "><a href="block-caching.html"><strong aria-hidden="true">31.2.</strong> Block Caching</a></li><li class="chapter-item expanded "><a href="block-io-engine.html"><strong aria-hidden="true">31.3.</strong> Block IO Engine</a></li><li class="chapter-item expanded "><a href="block-vhost-user.html"><strong aria-hidden="true">31.4.</strong> Block VHost User</a></li><li class="chapter-item expanded "><a href="patch-block.html"><strong aria-hidden="true">31.5.</strong> Patch Block</a></li><li class="chapter-item expanded "><a href="patch-network-interface.html"><strong aria-hidden="true">31.6.</strong> Patch Network Interface</a></li></ol></li><li class="chapter-item expanded "><a href="state-serialize.html"><strong aria-hidden="true">32.</strong> State Serialization Benchmarks</a></li><li class="chapter-item expanded "><a href="cpu-templates.html"><strong aria-hidden="true">33.</strong> CPU Templates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="boot-protocol.html"><strong aria-hidden="true">33.1.</strong> Boot Protocol</a></li><li class="chapter-item expanded "><a href="cpu-template-helper.html"><strong aria-hidden="true">33.2.</strong> CPU Template Helper</a></li><li class="chapter-item expanded "><a href="cpuid-normalization.html"><strong aria-hidden="true">33.3.</strong> CPUID Normalization</a></li></ol></li><li class="chapter-item expanded "><a href="mmds.html"><strong aria-hidden="true">34.</strong> MMDS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mmds-design.html"><strong aria-hidden="true">34.1.</strong> MMDS Design</a></li><li class="chapter-item expanded "><a href="mmds-user-guide.html"><strong aria-hidden="true">34.2.</strong> MMDS User Guide</a></li></ol></li><li class="chapter-item expanded "><a href="snapshotting.html"><strong aria-hidden="true">35.</strong> Snapshotting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="handling-page-faults-on-snapshot-resume.html"><strong aria-hidden="true">35.1.</strong> Handling Page Faults on Snapshot Resume</a></li><li class="chapter-item expanded "><a href="network-for-clones.html"><strong aria-hidden="true">35.2.</strong> Network For Clones</a></li><li class="chapter-item expanded "><a href="random-for-clones.html"><strong aria-hidden="true">35.3.</strong> Random For Clones</a></li><li class="chapter-item expanded "><a href="snapshot-editor.html"><strong aria-hidden="true">35.4.</strong> Snapshot Editor</a></li><li class="chapter-item expanded "><a href="snapshot-support.html"><strong aria-hidden="true">35.5.</strong> Snapshot Support</a></li><li class="chapter-item expanded "><a href="versioning.html"><strong aria-hidden="true">35.6.</strong> Versioning</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Firecracker</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started-with-firecracker"><a class="header" href="#getting-started-with-firecracker">Getting Started with Firecracker</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>You can check if your system meets the requirements by running
<code>firecracker/tools/devtool checkenv</code>.</p>
<p>An opinionated way to run Firecracker is to launch an
<a href="https://aws.amazon.com/ec2/">EC2</a> <code>c5.metal</code> instance with Ubuntu 22.04.</p>
<p>EC2 only supports nested virtualization on metal instances, which is why we use
<code>.metal</code> instances exclusively.</p>
<h3 id="architecture--os"><a class="header" href="#architecture--os">Architecture &amp; OS</a></h3>
<p>Firecracker supports <strong>x86_64</strong> and <strong>aarch64</strong> Linux, see
<a href="kernel-policy.html">specific supported kernels</a>.</p>
<h3 id="kvm"><a class="header" href="#kvm">KVM</a></h3>
<p>Firecracker requires <a href="https://www.linux-kvm.org/">the KVM Linux kernel module</a>.</p>
<p>The presence of the KVM module can be checked with:</p>
<pre><code class="language-bash">lsmod | grep kvm
</code></pre>
<p>An example output where it is enabled:</p>
<pre><code class="language-bash">kvm_intel             348160  0
kvm                   970752  1 kvm_intel
irqbypass              16384  1 kvm
</code></pre>
<p>Some Linux distributions use the <code>kvm</code> group to manage access to <code>/dev/kvm</code>,
while others rely on access control lists. If you have the ACL package for your
distro installed, you can grant Read+Write access with:</p>
<pre><code class="language-bash">sudo setfacl -m u:${USER}:rw /dev/kvm
</code></pre>
<p>Otherwise, if access is managed via the <code>kvm</code> group:</p>
<pre><code class="language-bash">[ $(stat -c &quot;%G&quot; /dev/kvm) = kvm ] &amp;&amp; sudo usermod -aG kvm ${USER} \
&amp;&amp; echo &quot;Access granted.&quot;
</code></pre>
<p>If none of the above works, you will need to either install the file
system ACL package for your distro and use the <code>setfacl</code> command as above,
or run Firecracker as <code>root</code> (via <code>sudo</code>).</p>
<p>You can check if you have access to <code>/dev/kvm</code> with:</p>
<pre><code class="language-bash">[ -r /dev/kvm ] &amp;&amp; [ -w /dev/kvm ] &amp;&amp; echo &quot;OK&quot; || echo &quot;FAIL&quot;
</code></pre>
<h2 id="running-firecracker"><a class="header" href="#running-firecracker">Running Firecracker</a></h2>
<p>In production, Firecracker is designed to be run inside
an execution jail, set up by the <a href="../src/jailer/"><code>jailer</code></a> binary. This is how
our <a href="#running-the-integration-test-suite">integration test suite</a> does it. This
guide will not use the <a href="../src/jailer/"><code>jailer</code></a>.</p>
<h3 id="getting-a-rootfs-and-guest-kernel-image"><a class="header" href="#getting-a-rootfs-and-guest-kernel-image">Getting a rootfs and Guest Kernel Image</a></h3>
<p>To successfully start a microVM with you will need an uncompressed Linux kernel binary,
and an ext4 file system image (to use as rootfs). This guide uses a 5.10 kernel image
with a Ubuntu 22.04 rootfs from our CI:</p>
<pre><code class="language-bash">ARCH=&quot;$(uname -m)&quot;

# Download a linux kernel binary
wget https://s3.amazonaws.com/spec.ccfc.min/firecracker-ci/v1.7/${ARCH}/vmlinux-5.10.204

# Download a rootfs
wget https://s3.amazonaws.com/spec.ccfc.min/firecracker-ci/v1.7/${ARCH}/ubuntu-22.04.ext4

# Download the ssh key for the rootfs
wget https://s3.amazonaws.com/spec.ccfc.min/firecracker-ci/v1.7/${ARCH}/ubuntu-22.04.id_rsa

# Set user read permission on the ssh key
chmod 400 ./ubuntu-22.04.id_rsa
</code></pre>
<h3 id="getting-a-firecracker-binary"><a class="header" href="#getting-a-firecracker-binary">Getting a Firecracker Binary</a></h3>
<p>There are two options for getting a firecracker binary:</p>
<ul>
<li>Downloading an official firecracker release from our
<a href="https://github.com/firecracker-microvm/firecracker/releases">release page</a>, or</li>
<li>Building firecracker from source.</li>
</ul>
<p>To download the latest firecracker release, run</p>
<pre><code class="language-bash">ARCH=&quot;$(uname -m)&quot;
release_url=&quot;https://github.com/firecracker-microvm/firecracker/releases&quot;
latest=$(basename $(curl -fsSLI -o /dev/null -w  %{url_effective} ${release_url}/latest))
curl -L ${release_url}/download/${latest}/firecracker-${latest}-${ARCH}.tgz \
| tar -xz

# Rename the binary to &quot;firecracker&quot;
mv release-${latest}-$(uname -m)/firecracker-${latest}-${ARCH} firecracker
</code></pre>
<p>To instead build firecracker from source, you will need to have <code>docker</code> installed:</p>
<pre><code class="language-bash">ARCH=&quot;$(uname -m)&quot;

# Clone the firecracker repository
git clone https://github.com/firecracker-microvm/firecracker firecracker_src

# Start docker
sudo systemctl start docker

# Build firecracker
#
# It is possible to build for gnu, by passing the arguments '-l gnu'.
#
# This will produce the firecracker and jailer binaries under
# `./firecracker/build/cargo_target/${toolchain}/debug`.
#
sudo ./firecracker_src/tools/devtool build

# Rename the binary to &quot;firecracker&quot;
sudo cp ./firecracker_src/build/cargo_target/${ARCH}-unknown-linux-musl/debug/firecracker firecracker
</code></pre>
<h3 id="starting-firecracker"><a class="header" href="#starting-firecracker">Starting Firecracker</a></h3>
<p>Running firecracker will require two terminals, the first one running the
firecracker binary, and a second one for communicating with the firecracker
process via HTTP requests:</p>
<pre><code class="language-bash">API_SOCKET=&quot;/tmp/firecracker.socket&quot;

# Remove API unix socket
sudo rm -f $API_SOCKET

# Run firecracker
sudo ./firecracker --api-sock &quot;${API_SOCKET}&quot;
</code></pre>
<p>In a new terminal (do not close the 1st one):</p>
<pre><code class="language-bash">TAP_DEV=&quot;tap0&quot;
TAP_IP=&quot;172.16.0.1&quot;
MASK_SHORT=&quot;/30&quot;

# Setup network interface
sudo ip link del &quot;$TAP_DEV&quot; 2&gt; /dev/null || true
sudo ip tuntap add dev &quot;$TAP_DEV&quot; mode tap
sudo ip addr add &quot;${TAP_IP}${MASK_SHORT}&quot; dev &quot;$TAP_DEV&quot;
sudo ip link set dev &quot;$TAP_DEV&quot; up

# Enable ip forwarding
sudo sh -c &quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;

HOST_IFACE=&quot;eth0&quot;

# Set up microVM internet access
sudo iptables -t nat -D POSTROUTING -o &quot;$HOST_IFACE&quot; -j MASQUERADE || true
sudo iptables -D FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT \
    || true
sudo iptables -D FORWARD -i tap0 -o &quot;$HOST_IFACE&quot; -j ACCEPT || true
sudo iptables -t nat -A POSTROUTING -o &quot;$HOST_IFACE&quot; -j MASQUERADE
sudo iptables -I FORWARD 1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -I FORWARD 1 -i tap0 -o &quot;$HOST_IFACE&quot; -j ACCEPT

API_SOCKET=&quot;/tmp/firecracker.socket&quot;
LOGFILE=&quot;./firecracker.log&quot;

# Create log file
touch $LOGFILE

# Set log file
curl -X PUT --unix-socket &quot;${API_SOCKET}&quot; \
    --data &quot;{
        \&quot;log_path\&quot;: \&quot;${LOGFILE}\&quot;,
        \&quot;level\&quot;: \&quot;Debug\&quot;,
        \&quot;show_level\&quot;: true,
        \&quot;show_log_origin\&quot;: true
    }&quot; \
    &quot;http://localhost/logger&quot;

KERNEL=&quot;./vmlinux-5.10.204&quot;
KERNEL_BOOT_ARGS=&quot;console=ttyS0 reboot=k panic=1 pci=off&quot;

ARCH=$(uname -m)

if [ ${ARCH} = &quot;aarch64&quot; ]; then
    KERNEL_BOOT_ARGS=&quot;keep_bootcon ${KERNEL_BOOT_ARGS}&quot;
fi

# Set boot source
curl -X PUT --unix-socket &quot;${API_SOCKET}&quot; \
    --data &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;${KERNEL}\&quot;,
        \&quot;boot_args\&quot;: \&quot;${KERNEL_BOOT_ARGS}\&quot;
    }&quot; \
    &quot;http://localhost/boot-source&quot;

ROOTFS=&quot;./ubuntu-22.04.ext4&quot;

# Set rootfs
curl -X PUT --unix-socket &quot;${API_SOCKET}&quot; \
    --data &quot;{
        \&quot;drive_id\&quot;: \&quot;rootfs\&quot;,
        \&quot;path_on_host\&quot;: \&quot;${ROOTFS}\&quot;,
        \&quot;is_root_device\&quot;: true,
        \&quot;is_read_only\&quot;: false
    }&quot; \
    &quot;http://localhost/drives/rootfs&quot;

# The IP address of a guest is derived from its MAC address with
# `fcnet-setup.sh`, this has been pre-configured in the guest rootfs. It is
# important that `TAP_IP` and `FC_MAC` match this.
FC_MAC=&quot;06:00:AC:10:00:02&quot;

# Set network interface
curl -X PUT --unix-socket &quot;${API_SOCKET}&quot; \
    --data &quot;{
        \&quot;iface_id\&quot;: \&quot;net1\&quot;,
        \&quot;guest_mac\&quot;: \&quot;$FC_MAC\&quot;,
        \&quot;host_dev_name\&quot;: \&quot;$TAP_DEV\&quot;
    }&quot; \
    &quot;http://localhost/network-interfaces/net1&quot;

# API requests are handled asynchronously, it is important the configuration is
# set, before `InstanceStart`.
sleep 0.015s

# Start microVM
curl -X PUT --unix-socket &quot;${API_SOCKET}&quot; \
    --data &quot;{
        \&quot;action_type\&quot;: \&quot;InstanceStart\&quot;
    }&quot; \
    &quot;http://localhost/actions&quot;

# API requests are handled asynchronously, it is important the microVM has been
# started before we attempt to SSH into it.
sleep 0.015s

# SSH into the microVM
ssh -i ./ubuntu-22.04.id_rsa root@172.16.0.2

# Use `root` for both the login and password.
# Run `reboot` to exit.
</code></pre>
<p>Issuing a <code>reboot</code> command inside the guest will gracefully shutdown Firecracker.
This is due to the fact that Firecracker doesn't implement guest power management.</p>
<h3 id="configuring-the-microvm-without-sending-api-requests"><a class="header" href="#configuring-the-microvm-without-sending-api-requests">Configuring the microVM without sending API requests</a></h3>
<p>You can boot a guest without using the API socket by passing the parameter
<code>--config-file</code> to the Firecracker process.
E.g.:</p>
<pre><code class="language-wrap">./firecracker --api-sock /tmp/firecracker.socket --config-file &lt;path_to_the_configuration_file&gt;
</code></pre>
<p><code>path_to_the_configuration_file</code> is the path to a JSON file with the
configuration for all of the microVM's resources. The JSON <strong>must</strong> contain the
configuration for the guest kernel and rootfs, all of the other resources are
optional. This configuration method will also start the microVM, as such you
need to specify all desired pre-boot configurable resources in the JSON. The
names of the resources can be seen in
<a href="../src/api_server/swagger/firecracker.yaml"><code>firecracker.yaml</code></a> and the
names of their fields are the same that are used in the API requests.</p>
<p>An example of configuration file is provided:
<a href="../tests/framework/vm_config.json"><code>tests/framework/vm_config.json</code></a>.</p>
<p>Once the guest is booted, refer <a href="./network-setup.html#in-the-guest">network-setup</a>
to bring up the network in the guest machine.</p>
<p>After the microVM is started you can still use the socket to send API requests
for post-boot operations.</p>
<h3 id="building-firecracker"><a class="header" href="#building-firecracker">Building Firecracker</a></h3>
<p>SSH can be used to work with libraries from private git repos by passing
the <code>--ssh-keys</code> flag to specify the paths to your public and private SSH keys
on the host. Both are required for git authentication when fetching the
repositories.</p>
<pre><code class="language-bash">tools/devtool build --ssh-keys ~/.ssh/id_rsa.pub ~/.ssh/id_rsa
</code></pre>
<p>Only a single set of credentials is supported. <code>devtool</code> cannot fetch multiple
private repos which rely on different credentials.</p>
<p><code>tools/devtool build</code> builds in <code>debug</code> to build release binaries pass
<code>--release</code> e.g. <code>tools/devtool build --release</code></p>
<p>Documentation on <code>devtool</code> can be seen with <code>tools/devtool --help</code>.</p>
<h2 id="running-the-integration-test-suite"><a class="header" href="#running-the-integration-test-suite">Running the Integration Test Suite</a></h2>
<p>Integration tests can be run with <code>tools/devtool test</code>.</p>
<p>The test suite is designed to ensure our <a href="../SPECIFICATION.html">SLA parameters</a>
as measured on EC2 .metal instances, as such performance tests may fail when not
run on these machines. Specifically, don't be alarmed if you see
<code>tests/integration_tests/performance/test_process_startup_time.py</code> failing when
not run on an EC2 .metal instance. You can skip performance tests with:</p>
<pre><code class="language-bash">./tools/devtool test -- --ignore integration_tests/performance
</code></pre>
<p>If you run the integration tests on an EC2 .metal instance, and encounter
failures such as the following</p>
<p><code>FAILED integration_tests/style/test_markdown.py::test_markdown_style - requests.exceptions.ReadTimeout: HTTPConnectionPool(host='169.254.169.254', port=80): Read timed out. (read timeout=2)</code></p>
<p>try running <code>aws ec2 modify-instance-metadata-options --instance-id i-&lt;your instance id&gt; --http-put-response-hop-limit 2</code>. The integration tests framework
uses IMDSv2 to determine information such as instance type. The additional hop
is needed because the IMDS requests will pass through docker.</p>
<h2 id="errors-while-using-curl-to-access-the-api"><a class="header" href="#errors-while-using-curl-to-access-the-api">Errors while using <code>curl</code> to access the API</a></h2>
<p>Points to check to confirm the API socket is running and accessible:</p>
<ul>
<li>Check that the user running the Firecracker process and the user using <code>curl</code>
have equivalent privileges. For example, if you run Firecracker with <strong>sudo</strong>
that you run <code>curl</code> with <strong>sudo</strong> as well.</li>
<li><a href="https://man7.org/linux/man-pages/man8/selinux.8.html">SELinux</a> can regulate
access to sockets on RHEL based distributions. How user's permissions are
configured is environmentally specific, but for the purposes of
troubleshooting you can check if it is enabled in <code>/etc/selinux/config</code>.</li>
<li>With the Firecracker process running using <code>--api-sock /tmp/firecracker.socket</code>,
confirm that the socket is open:
<ul>
<li><code>ss -a | grep '/tmp/firecracker.socket'</code></li>
<li>If you have socat available, try <code>socat - UNIX-CONNECT:/tmp/firecracker.socket</code>
This will throw an explicit error if the socket is inaccessible, or it will pause
and wait for input to continue.</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="SECURITY.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="CONTRIBUTING.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="SECURITY.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="CONTRIBUTING.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
